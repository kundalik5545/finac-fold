// Prisma Schema for the project

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Test {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  name      String

  @@map("tests")
}

model User {
  id                     String                   @id
  name                   String
  email                  String
  emailVerified          Boolean                  @default(false)
  image                  String?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @updatedAt
  sessions               Session[]
  accounts               Account[]
  assets                 Asset[]
  assetsTransactions     AssetsTransaction[]
  todos                  Todo[]
  todoCategories         TodoCategory[]
  todoTags               TodoTag[]
  goals                  Goal[]
  goalTransactions       GoalTransaction[]
  bankAccounts           BankAccount[]
  bankTransactions       BankTransaction[]
  categories             Category[]
  subCategories          SubCategory[]
  bankCards              bankCard[]
  transactions           Transaction[]
  investments            Investment[]
  investmentTransactions InvestmentTransaction[]
  investmentPriceHistory InvestmentPriceHistory[]
  chats                  Chat[]

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}

// Assets Model
model Asset {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name  String
  type  AssetType
  icon  String?
  color String?

  currentValue   Decimal        @db.Decimal(65, 4)
  purchaseValue  Decimal        @db.Decimal(65, 4)
  purchaseDate   DateTime
  purchaseReason String?
  paymentMethod  PaymentMethod?

  sellDate   DateTime?
  sellPrice  Decimal?  @db.Decimal(65, 4)
  profitLoss Decimal?  @db.Decimal(65, 4)
  sellReason String?

  transactionStatus TransactionStatus?
  description       String?

  userId             String
  user               User                @relation(fields: [userId], references: [id])
  assetsTransactions AssetsTransaction[]

  @@index([userId, type])
}

// Assets Transaction Model - Tracks historical price changes
model AssetsTransaction {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  value Decimal  @db.Decimal(65, 4)
  date  DateTime
  notes String?

  assetId String
  asset   Asset  @relation(fields: [assetId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id])

  @@index([assetId, date])
  @@index([userId])
  @@map("assets_transaction")
}

// Todo List Models
model Todo {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  title       String
  description String?
  dueDate     DateTime?
  priority    TodoPriority @default(MEDIUM)
  completed   Boolean      @default(false)
  completedAt DateTime?

  categoryId String?
  category   TodoCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  tags       TodoTag[]

  recurringId String?
  recurring   RecurringTodo? @relation(fields: [recurringId], references: [id], onDelete: SetNull)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, dueDate])
  @@index([userId, completed])
  @@map("todo")
}

model TodoCategory {
  id     String  @id @default(uuid())
  name   String
  color  String?
  userId String
  user   User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  todos  Todo[]

  @@unique([userId, name])
  @@map("todo_category")
}

model TodoTag {
  id     String @id @default(uuid())
  name   String
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  todos  Todo[]

  @@unique([userId, name])
  @@map("todo_tag")
}

model RecurringTodo {
  id        String             @id @default(uuid())
  frequency RecurringFrequency
  interval  Int                @default(1)
  startDate DateTime
  endDate   DateTime?
  todos     Todo[]

  @@map("recurring_todo")
}

// Goal Model
model Goal {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name          String
  targetAmount  Decimal  @db.Decimal(65, 4)
  currentAmount Decimal  @default(0) @db.Decimal(65, 4)
  targetDate    DateTime
  description   String?
  icon          String?
  color         String?
  isActive      Boolean  @default(true)

  userId           String
  user             User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  goalTransactions GoalTransaction[]

  @@index([userId, isActive])
  @@map("goals")
}

// Goal Transaction Model - Tracks goal progress over time
model GoalTransaction {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  amount Decimal  @db.Decimal(65, 4)
  date   DateTime
  notes  String?

  goalId String
  goal   Goal   @relation(fields: [goalId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id])

  @@index([goalId, date])
  @@index([userId])
  @@map("goal_transaction")
}

// Bank Account Model
model BankAccount {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name               String
  accountNumber      String?
  bankName           String?
  accountType        AccountType?
  ifscCode           String?
  branch             String?
  startingBalance    Decimal      @default(0) @db.Decimal(65, 4)
  icon               String?
  color              String?
  description        String?
  isActive           Boolean      @default(true)
  accountOpeningDate DateTime?
  isInsuranceActive  Boolean?     @default(false)
  insuranceAmount    Decimal?     @db.Decimal(65, 4)

  userId           String
  user             User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  bankTransactions BankTransaction[]
  bankCards        bankCard[]
  transactions     Transaction[]

  @@index([userId])
  @@index([userId, accountNumber])
  @@map("bank_account")
}

model bankCard {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name           String
  cardNumber     String?
  cardType       CardType
  cardIssuer     String?
  cvv            String?
  expiryDate     DateTime?
  limit          Decimal?       @default(0) @db.Decimal(65, 4)
  lastBillAmount Decimal?       @default(0) @db.Decimal(65, 4)
  paymentDueDay  Int?
  paymentMethod  String?
  cardPin        String?        @default("1234")
  paymentStatus  PaymentStatus?
  paymentAmount  Decimal?       @default(0) @db.Decimal(65, 4)
  paymentDate    DateTime?
  color          String?
  icon           String?
  notes          String?
  isActive       Boolean        @default(true)

  userId        String
  user          User        @relation(fields: [userId], references: [id])
  bankAccountId String
  bankAccount   BankAccount @relation(fields: [bankAccountId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([bankAccountId])
  @@map("bank_card")
}

// Bank Transaction Model - Tracks all transactions for a bank account
model BankTransaction {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  amount          Decimal         @db.Decimal(65, 4)
  totalDeposit    Decimal         @default(0.0) @db.Decimal(65, 4)
  totalWithdrawal Decimal         @default(0.0) @db.Decimal(65, 4)
  currentBalance  Decimal         @db.Decimal(65, 4)
  transactionDate DateTime
  transactionType TransactionType
  description     String?

  bankAccountId String
  bankAccount   BankAccount @relation(fields: [bankAccountId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id])

  @@index([bankAccountId, transactionDate])
  @@index([userId])
  @@index([userId, transactionType])
  @@index([transactionDate])
  @@map("bank_transaction")
}

model Category {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name          String
  type          CategoryType
  color         String?
  icon          String?
  userId        String
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  subCategories SubCategory[]
  transactions  Transaction[]

  @@unique([userId, name])
  @@index([userId])
  @@map("category")
}

model SubCategory {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name         String
  color        String?
  icon         String?
  userId       String?
  categoryId   String
  category     Category      @relation(fields: [categoryId], references: [id])
  user         User?         @relation(fields: [userId], references: [id])
  transactions Transaction[]

  @@unique([userId, categoryId, name])
  @@index([userId])
  @@index([categoryId])
  @@map("sub_category")
}

// Tranasction model
model Transaction {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  amount          Decimal           @db.Decimal(65, 4)
  transactionType TransactionType
  status          TransactionStatus @default(PENDING)
  date            DateTime
  description     String?
  currency        Currency          @default(INR)
  isActive        Boolean           @default(true)
  userId          String
  bankAccountId   String?
  categoryId      String?
  subCategoryId   String?
  paymentMethod   PaymentMethod?
  investmentId    String?

  category    Category?    @relation(fields: [categoryId], references: [id])
  subCategory SubCategory? @relation(fields: [subCategoryId], references: [id])
  user        User         @relation(fields: [userId], references: [id])
  bankAccount BankAccount? @relation(fields: [bankAccountId], references: [id])
  investment  Investment?  @relation(fields: [investmentId], references: [id])

  @@index([userId])
  @@index([categoryId])
  @@index([date])
  @@map("transaction")
}

// Currency Enum
enum Currency {
  INR
  USD
  EUR
  GBP
  OTHER
}

// Budget Model
// Asset Type Enum
enum AssetType {
  PROPERTY
  VEHICLE
  JEWELRY
  ELECTRONICS
  OTHER
}

// Sell Status Enum
enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
}

// Payment Method Enum
enum PaymentMethod {
  CASH
  UPI
  CARD
  ONLINE
  OTHER
}

// Todo Priority Enum
enum TodoPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

// Recurring Frequency Enum
enum RecurringFrequency {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
}

// Account Type Enum
enum AccountType {
  SAVINGS
  CHECKING
  CURRENT
  OTHER
}

// Transaction Type Enum
enum TransactionType {
  CREDIT
  DEBIT
}

// Card Type Enum
enum CardType {
  DEBIT
  CREDIT
  PREPAID
  OTHER
}

// Payment Status Enum
enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
}

enum CategoryType {
  INCOME
  EXPENSE
  TRANSFER
  INVESTMENT
}

// Investment Type Enum
enum InvestmentType {
  STOCKS
  MUTUAL_FUNDS
  GOLD
  FIXED_DEPOSIT
  NPS
  PF
}

// Investment Transaction Type Enum
enum InvestmentTransactionType {
  INVEST
  WITHDRAW
}

// Price Source Enum
enum PriceSource {
  MANUAL
  API
}

// Chat Response Type Enum
enum ChatResponseType {
  TEXT
  TABLE
  CHART
}

// Chat Message Role Enum
enum ChatMessageRole {
  USER
  ASSISTANT
}

// Chat Model - Stores chat sessions
model Chat {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  title  String
  userId String
  user   User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages ChatMessage[]

  @@index([userId])
  @@index([userId, createdAt])
  @@map("chat")
}

// Chat Message Model - Stores individual messages
model ChatMessage {
  id          String          @id @default(uuid())
  createdAt   DateTime        @default(now())

  chatId      String
  chat        Chat            @relation(fields: [chatId], references: [id], onDelete: Cascade)
  role        ChatMessageRole
  content     String
  responseType ChatResponseType? @default(TEXT)
  metadata    Json?

  @@index([chatId, createdAt])
  @@map("chat_message")
}

// Investment Model
model Investment {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name           String
  type           InvestmentType
  symbol         String? // Ticker/symbol for stocks/MF
  icon           String?
  color          String?
  currentPrice   Decimal        @default(0) @db.Decimal(65, 4)
  investedAmount Decimal        @default(0) @db.Decimal(65, 4)
  currentValue   Decimal        @default(0) @db.Decimal(65, 4)
  quantity       Decimal        @default(0) @db.Decimal(65, 4) // Units/shares
  purchaseDate   DateTime
  description    String?

  userId                 String
  user                   User                     @relation(fields: [userId], references: [id], onDelete: Cascade)
  investmentTransactions InvestmentTransaction[]
  investmentPriceHistory InvestmentPriceHistory[]
  transactions           Transaction[]

  @@index([userId])
  @@index([userId, type])
  @@index([type])
  @@map("investment")
}

// Investment Transaction Model - For manual updates (FD, NPS, PF)
model InvestmentTransaction {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  amount          Decimal                   @db.Decimal(65, 4)
  date            DateTime
  transactionType InvestmentTransactionType
  notes           String?

  investmentId String
  investment   Investment @relation(fields: [investmentId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id])

  @@index([investmentId, date])
  @@index([userId])
  @@map("investment_transaction")
}

// Investment Price History Model - Tracks price changes over time
model InvestmentPriceHistory {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  price  Decimal     @db.Decimal(65, 4)
  date   DateTime
  source PriceSource

  investmentId String
  investment   Investment @relation(fields: [investmentId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id])

  @@index([investmentId, date])
  @@index([userId])
  @@map("investment_price_history")
}
